document:
  dsl: "1.0.0"
  namespace: "hostctl"
  name: "troubleshoot"
  version: "1.0.0"
do:
  - preflight:
      call: "preflight"
      then: "flash_firmware"
  - flash_firmware:
      call: "flash_firmware"
      then: "flash_gate"
  - flash_gate:
      switch:
        - flash_failed:
            when: ".flash_ok == false"
            then: "failure_hint_gate"
        - flash_passed:
            then: "run_uart_probes"
  - run_uart_probes:
      call: "run_uart_probes"
      then: "probe_gate"
  - probe_gate:
      switch:
        - probe_failed:
            when: ".probe_ok == false"
            then: "failure_hint_gate"
        - probe_passed:
            then: "run_boot_soak"
  - run_boot_soak:
      call: "run_boot_soak"
      then: "soak_gate"
  - soak_gate:
      switch:
        - soak_failed:
            when: ".soak_ok == false"
            then: "failure_hint_gate"
        - soak_passed:
            then: "mark_success"
  - failure_hint_gate:
      switch:
        - transport_hint:
            when: ".failure_class == \"uart_transport\""
            then: "hint_uart_transport"
        - runtime_hint:
            when: ".failure_class == \"runtime\""
            then: "hint_runtime"
        - dhcp_no_ipv4_hint:
            when: ".failure_class == \"dhcp_no_ipv4_stall\""
            then: "hint_dhcp_no_ipv4"
        - default_summary:
            then: "print_summary"
  - hint_uart_transport:
      call: "hint_uart_transport"
      then: "print_summary"
  - hint_runtime:
      call: "hint_runtime"
      then: "print_summary"
  - hint_dhcp_no_ipv4:
      call: "hint_dhcp_no_ipv4"
      then: "print_summary"
  - mark_success:
      call: "mark_success"
      then: "print_summary"
  - print_summary:
      call: "print_summary"
